<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>çº¦é¥­æŠ¥å</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; margin: 24px; }
    h1 { color: #e91e63; margin-bottom: 8px; }
    iframe { border: none; width: 100%; height: 600px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #fafafa; position: sticky; top: 0; }
  </style>
</head>
<body>
  <h1>ğŸœ çº¦é¥­æŠ¥å Beta v0.0.2ç‰ˆ</h1>

  <!-- 1) ä½ çš„ Google Formï¼ˆä¿æŒä¸å˜ï¼‰ -->
  <h2>å¡«å†™æŠ¥åè¡¨</h2>
  <iframe
    src="https://docs.google.com/forms/d/e/1FAIpQLSd7ZIaZY3jlKepyQcsks99s9GZoZwtC813_PMQiHvoyVb9AFQ/viewform?embedded=true">
  </iframe>

  <!-- 2) æŠ¥åç»“æœï¼ˆè‡ªåŠ¨ä» Sheet æ‹‰ JSON å¹¶æ¸²æŸ“ï¼‰ -->
  <h2>å½“å‰æŠ¥åæƒ…å†µ</h2>
  <table id="signup-table">
    <thead><tr id="signup-head"></tr></thead>
    <tbody id="signup-body"></tbody>
  </table>

  <script>
    // âœ¦âœ¦âœ¦ æŠŠä¸‹é¢ SHEET_ID å’Œ SHEET_NAME æ”¹æˆä½ çš„ âœ¦âœ¦âœ¦
    // 1) SHEET_IDï¼šè¡¨æ ¼é“¾æ¥ä¸­ /d/ å’Œ /edit ä¹‹é—´çš„é‚£ä¸² ID
    const SHEET_ID   = "1hHyebhKYPIfgjD9qPOS5h0iJp3ey8hQA6hVc6dBhzyI";
    const SHEET_NAME = "default";

    // ä½¿ç”¨ Google Visualization APIï¼šè¿”å› JSONï¼ˆè¢«å‡½æ•°åŒ…è£¹ä¸€ä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨å‰¥å£³ï¼‰
    const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq` +
                     `?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&tq=${encodeURIComponent("select *")}`;

    async function loadData() {
      const head = document.getElementById("signup-head");
      const body = document.getElementById("signup-body");
      head.innerHTML = "<th>åŠ è½½ä¸­â€¦â€¦</th>";
      body.innerHTML = "";

      const resp = await fetch(GVIZ_URL);
      const txt  = await resp.text();

      // å»æ‰å‰åçš„å‡½æ•°åŒ…è£…ï¼Œåªä¿ç•™ JSON
      const json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}") + 1));

      // è¡¨å¤´
      const cols = json.table.cols.map(c => c.label || "").filter(Boolean);
      head.innerHTML = cols.map(h => `<th>${h}</th>`).join("");

      // æ•°æ®è¡Œï¼ˆä¼˜å…ˆç”¨ c.f çš„æ ¼å¼åŒ–å€¼ï¼›æ²¡æœ‰å°±ç”¨ c.vï¼‰
      const rows = json.table.rows.map(r => r.c.map(c => (c && (c.f ?? c.v)) ?? ""));

      // å¯é€‰ï¼šæŒ‰æ—¶é—´æˆ³å€’åºï¼ˆå¦‚æœç¬¬ä¸€åˆ—æ˜¯ Timestampï¼‰
      rows.sort((a, b) => new Date(b[0]) - new Date(a[0]));

      body.innerHTML = rows.map(r =>
        `<tr>${r.map(v => `<td>${String(v).replace(/</g,"&lt;").replace(/>/g,"&gt;")}</td>`).join("")}</tr>`
      ).join("");
    }

    loadData();
    setInterval(loadData, 30000); // æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
  </script>
</body>
</html>
